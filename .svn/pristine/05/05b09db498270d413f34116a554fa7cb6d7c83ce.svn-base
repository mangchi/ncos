<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="Auth">
  

  
   <select id="selectUserAccount" parameterType="UserVo" resultType="UserVo">

     	SELECT  A.ACCOUNT_ID
     	      , A.CLASS_ID
     	      , A.AFFILIATION_ID
     	      , A.USER_ID
     	      , A.PASSWORD
     	      , A.TERMINAL_IP
     	      , A.USERNAME
     	      , A.AUTHORIZATION
     	      , A.PHONE_NO
     	      , A.EMAIL
     	      , A.MILITARY_SERVICE_NUMBER
     	      , B.ACCOUNT_ACTIVATION
     	      , C.ALARM_STATUS
     	      , C.WARNING_STATUS
     	      , C.SESSION_CONTROL_STATUS
     	      , C.ALARM_LEVEL
     	      , C.WARNING_LEVEL
     	  FROM user_account A
     	  INNER JOIN account_status B
     	  ON A.ACCOUNT_ID = B.ACCOUNT_ID
     	  LEFT JOIN account_setting C
     	  ON A.ACCOUNT_ID = C.ACCOUNT_ID
     	 WHERE A.USER_ID = #{userId}
     	 <if test='systemId != null and !systemId.equals("")'>
           AND A.PASSWORD = #{password}
         </if>
     	 LIMIT 1
  </select>
  
   <select id="selectSsoUserAccount" parameterType="UserVo" resultType="UserVo">

     	SELECT  A.ACCOUNT_ID
     	      , A.CLASS_ID
     	      , A.AFFILIATION_ID
     	      , A.USER_ID
     	      , A.PASSWORD
     	      , A.TERMINAL_IP
     	      , A.USERNAME
     	      , A.AUTHORIZATION
     	      , A.PHONE_NO
     	      , A.EMAIL
     	      , A.MILITARY_SERVICE_NUMBER
     	      , B.ACCOUNT_ACTIVATION
     	      , C.ALARM_STATUS
     	      , C.WARNING_STATUS
     	      , C.SESSION_CONTROL_STATUS
     	      , C.ALARM_LEVEL
     	      , C.WARNING_LEVEL
     	  FROM user_account A
     	  INNER JOIN account_status B
     	  ON A.ACCOUNT_ID = B.ACCOUNT_ID
     	  LEFT JOIN account_setting C
     	  ON A.ACCOUNT_ID = C.ACCOUNT_ID
     	 WHERE A.USER_ID = #{userId}
     	 LIMIT 1
  </select>  
  
  <update id="updateLogin" parameterType="UserVo">
       UPDATE account_status SET IS_LOGIN = #{isLogin}
       <if test='isLogin == 1'>
                               , LAST_SUCCESS_ACCESS_DATE = SYSDATE()
       </if>
       WHERE ACCOUNT_ID = #{accountId}
       <selectKey keyColumn="LAST_SUCCESS_ACCESS_DATE" keyProperty="lastSuccessAccessDate" resultType="java.util.Date" order="AFTER">
		SELECT
				LAST_SUCCESS_ACCESS_DATE
		FROM	account_status
		WHERE ACCOUNT_ID = #{accountId}
	   </selectKey>
  </update>
  
  
 
   
</mapper>