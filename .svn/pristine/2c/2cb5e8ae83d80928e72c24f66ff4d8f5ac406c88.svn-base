<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="Net">
  
   <select id="selectNetEquipList" parameterType="HashMap" resultType="CmmnMap">
	   SELECT  ASSET_ID, CONCAT(ASSET_NAME,'(',CODE_KR,')') ASSET_NM
	   FROM network_asset_info A
	   LEFT JOIN code_info B
	   ON A.SMALL_CATEGORY = B.CODE
	   AND MAINGROUP = 'AS'
	   AND SUBGROUP = 'SC'
	   ORDER BY ASSET_ID 
  </select>
  
  
  <select id="selectTopoList" parameterType="HashMap" resultType="CmmnMap">
	    SELECT LINK_ID  
	      , UPPER_LINK_ID  
          , A.ASSET_ID 
          , B.ASSET_NAME
          , C.CODE
          , C.CODE_KR
          , LINK_TYPE
          , B.LARGE_CATEGORY
       FROM link_info A
       INNER JOIN network_asset_info B 
       ON A.ASSET_ID = B.ASSET_ID
       INNER JOIN  code_info C
       ON  B.SMALL_CATEGORY = C.CODE
       AND C.MAINGROUP = 'AS'
       AND C.SUBGROUP = 'SC'    
       ORDER BY LINK_ID 

  </select>
  
   <select id="selectErrorAssetList" parameterType="map" resultType="CmmnMap">


			SELECT A.*
			FROM 
				(SELECT D.ASSET_ID
				      , E.LINK_ID
				FROM asset_status_info A
				LEFT JOIN code_info B
				ON    A.ASSET_STATUS = B.CODE
				AND   B.MAINGROUP = 'AS'
				AND   B.SUBGROUP = 'ST'
				LEFT JOIN reason_v C
				ON    A.SYSTEM_ID = C.systemId AND A.REASON_ID = C.statusCode
				LEFT JOIN network_asset_info D
				ON A.SYSTEM_ID = D.SYSTEM_ID
				LEFT JOIN link_info E
				ON D.ASSET_ID = E.ASSET_ID
				WHERE A.ASSET_STATUS != 2
				AND   A.DETECTION_TIME > DATE_ADD(NOW(), INTERVAL -#{intervalHm} HOUR)
				UNION ALL 
				SELECT 
				      CONCAT(C.ASSET_ID,'-',D.ASSET_ID)
				    , CONCAT(E.LINK_ID,'-',F.LINK_ID)
				FROM threat_info A
				LEFT JOIN code_info B
				ON    A.THREAT_IMPORTANCE = B.CODE
				AND   B.MAINGROUP = 'TH'
				AND   B.SUBGROUP = 'IM' 
				LEFT JOIN network_asset_info C
				ON A.SRC_IP = C.IP_ADDRESS
				LEFT JOIN network_asset_info D
				ON A.SRC_IP = D.IP_ADDRESS
				LEFT JOIN link_info E
				ON C.ASSET_ID = E.ASSET_ID
				LEFT JOIN link_info F
				ON D.ASSET_ID = F.ASSET_ID
				WHERE   A.DETECTION_TIME > DATE_ADD(NOW(), INTERVAL -#{intervalHm} HOUR)) A

  </select>
  
  
  

   
</mapper>