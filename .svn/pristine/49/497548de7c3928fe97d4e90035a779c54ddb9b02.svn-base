<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Train">


  <select id="selectTrainCount" parameterType="map" resultType="long">
        SELECT COUNT(1)
          FROM train_result A
        <include refid="whereTrainList"></include>
  </select>

  <select id="selectTrainList" parameterType="HashMap" resultType="CmmnMap">

     	SELECT  RN
     	      , B.ID
     	      , B.TRAIN_TIME
     	      , B.ACCURACY
     	      , B.PRECISION
     	      , B.RECALL
     	      , B.F1SCORE 
        FROM ( SELECT A.ID
                    , ROW_NUMBER() OVER (ORDER BY A.ID DESC) AS RN
               FROM train_result A
               <include refid="whereTrainList"></include>
               LIMIT #{startRow},#{rowPerPage}) A
        STRAIGHT_JOIN train_result B
        ON (A.ID = B.ID)
        ORDER BY RN

  </select>

   <sql id="whereTrainList">
         <where>
	         <choose>
	         <when test='schMode != null and schMode.equals("menual")'>
		         <if test='frDt != null and !frDt.equals("")'>
		         AND A.TRAIN_TIME <![CDATA[>=]]> #{frDt}
		         </if>
		         <if test='toDt != null and !toDt.equals("")'>
		         AND A.TRAIN_TIME <![CDATA[<=]]> #{toDt}
		         </if>
	             <choose>
	             <when test='schIndex != null and schIndex.equals("1")'>
	             AND A.ACCURACY > #{schPt}
	             </when>
	              <when test='schIndex != null and schIndex.equals("2")'>
	             AND A.PRECISION > #{schPt}
	             </when>
	              <when test='schIndex != null and schIndex.equals("3")'>
	             AND A.RECALL > #{schPt}
	             </when>
	              <when test='schIndex != null and schIndex.equals("4")'>
	             AND A.F1SCORE > #{schPt}
	             </when>
	             <otherwise>
	             </otherwise>
	             </choose>
	         </when>
	         <otherwise>
	         AND A.TRAIN_TIME > DATE_ADD(NOW(), INTERVAL -#{intervalHm} HOUR)
	         </otherwise>
	         </choose>
         </where>
   </sql>


  <select id="selectTrainInfo" resultType="CmmnMap">
      SELECT TP,TN,FP,FN
        FROM train_result 
      ORDER BY TRAIN_TIME DESC
      LIMIT 1
         
  </select>

  

</mapper>