<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Cmmn">

  <!-- code -->
  <select id="selectCode" parameterType="CodeVo" resultType="CodeVo">
      SELECT *
      FROM
	      (SELECT CODE_ID
	            , CONCAT(MAINGROUP,SUBGROUP) AS GRP_CD
	            , CODE AS CD
	            , CODE_KR AS CD_NM
	            , SORT
	        FROM code_info
	        WHERE USE_FLAG = 1
	        UNION ALL
	        SELECT ACCOUNT_ID
	              ,'UA'
	              , ACCOUNT_ID
	              , USERNAME
	              , CAST(ACCOUNT_ID AS INTEGER)
	        FROM user_account
	        ) A
       ORDER BY GRP_CD,CD ,SORT
  </select>

  <select id="selectEquipList" parameterType="HashMap" resultType="CmmnMap">
	     SELECT *
	     FROM
	     (SELECT 0 AS ID, NULL AS UPPER_ID, '네트워크 장비' AS CLASS_NM
	     UNION ALL
	     SELECT CODE ID, 0 UPPER_ID, CODE_KR CLASS_NM
	       FROM code_info
	     WHERE MAINGROUP = 'AS'
	     AND SUBGROUP = 'SC'
	     ) A
	     ORDER BY ID DESC
  </select>

  <select id="selectEquipStatusList" parameterType="HashMap" resultType="CmmnMap">
	    SELECT * 
	     FROM 
		     (SELECT '0' AS ID
			       , NULL AS UPPER_ID
					 , '네트워크 장비' AS CLASS_NM
					 , 0 IS_SHIP
					 , NULL ASSET_STATUS
					 , NULL COUNT
		     UNION ALL
		     SELECT AFFILIATION_ID ID
		          , CASE WHEN BELONGPARENTID IS NULL THEN '0' ELSE BELONGPARENTID END  UPPER_ID
		          , affiliation AS CLASS_NM
		          , IS_SHIP
		          , ASSET_STATUS
		          , COUNT
		    FROM v_tree_data
		     ) A
	     ORDER BY ID DESC
  </select>
  
  <select id="selectShipStatusList" parameterType="HashMap" resultType="CmmnMap">
		    WITH RECURSIVE V_TREE AS (
              SELECT  AFFILIATION_ID 
		               , BELONGPARENTID 
		               , affiliation 
		               , cast(AFFILIATION_ID AS CHAR(100) CHARACTER SET UTF8) AS ID_PATH
		               , IS_SHIP
		               , ASSET_STATUS
		               , COUNT

		         FROM v_tree_data
					WHERE BELONGPARENTID IS NULL
		         UNION ALL
		         SELECT  P.AFFILIATION_ID
					   , P.BELONGPARENTID 
		               , P.affiliation 
		               , CONCAT(C.id_path,',',P.AFFILIATION_ID) AS ID_PATH
		               , P.IS_SHIP
		               , P.ASSET_STATUS
		               , P.COUNT
		         FROM v_tree_data P
		         INNER JOIN V_TREE C ON C.AFFILIATION_ID = P.BELONGPARENTID
		   )
		   SELECT  AFFILIATION_ID
		        , affiliation
		        , ID_PATH
		        , ASSET_STATUS
		        , COUNT
		        , CASE WHEN LENGTH(TRIM(ASSET_STATUS)) > 0  OR COUNT > 0 THEN 'Y' ELSE 'N' END THREAT_YN
		   FROM V_TREE
		   WHERE IS_SHIP = 1
		   ORDER BY ID_PATH
  </select>
  
  
  
   <select id="selectLinkInfoList" parameterType="HashMap" resultType="CmmnMap">
	     SELECT LINK_ID ID
	          , CASE WHEN UPPER_LINK_ID = 0 THEN NULL ELSE UPPER_LINK_ID END UPPER_ID
	          , A.ASSET_ID
              , CASE WHEN C.CODE_KR IS NULL THEN '장비 연결' ELSE CONCAT(B.ASSET_NAME,'(',C.CODE_KR,')') END CLASS_NM
	          , LINK_TYPE
	       FROM link_info A
	       LEFT JOIN network_asset_info B
	       ON A.ASSET_ID = B.ASSET_ID
	       LEFT JOIN  code_info C
	       ON  B.SMALL_CATEGORY = C.CODE
	       AND C.MAINGROUP = 'AS'
	       AND C.SUBGROUP = 'SC'
	       ORDER BY LINK_ID DESC
  </select>

  <select id="selectZoneList" parameterType="HashMap" resultType="CmmnMap">
       SELECT ZONE_ID CD
            , ZONE_NAME CD_NM
        FROM zone_location
       WHERE ZONE_NAME IS NOT NULL
       ORDER BY ZONE_ID
  </select>

  <select id="selectWhiteList" parameterType="HashMap" resultType="CmmnMap">

        SELECT POLICY_ID AS ID
             , POLICY_NAME
             , SRC_IP
             , SRC_MASK
             , DST_IP
             , DST_MASK
             , SRC_START_PORT
             , SRC_END_PORT
             , DST_START_PORT
             , DST_END_PORT
             , PROTOCOL
             , POLICY
        FROM whitelist_policy
        ORDER BY POLICY_ID DESC


  </select>

  <select id="selectFalsePositiveList" parameterType="HashMap" resultType="CmmnMap">
        SELECT * FROM (
        SELECT '0' AS ID, '001' AS ANALYSIS_RESULT, '210.210.220.210' AS SEND_IP
              ,'210.210.220.105' AS RECV_IP,'8500' AS SEND_PORT, '2100' AS RECV_PORT ,'001' AS ACT_RESULT
        UNION ALL
        SELECT '1' , '001' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '2' , '002' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '3' , '001' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '4' , '001' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '5' , '001' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '6' , '001' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '6' , '001' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '7' , '002' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '8' , '002' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'
        UNION ALL
        SELECT '9' , '002' , '210.210.220.210','210.210.220.105' ,'8500' , '2100' , '001'      ) A
        ORDER BY A.ID DESC


  </select>

   <select id="selectWatchThreatList" parameterType="HashMap" resultType="CmmnMap">
    	SELECT A.DETECTION_TIME
    	     , A.UNIT_ID
    	     , A.SHIP_ID
    	     , A.DETECTION_THREAT_NAME
    	     , A.THREAT_DETECTION_METHOD
    	     , A.THREAT_IMPORTANCE
    	     , A.THREAT_ID
        FROM threat_info A
        <where>
		<if test='login == null or login.equals("")'>
         AND A.DETECTION_TIME >= (SELECT LAST_SUCCESS_ACCESS_DATE FROM account_status WHERE ACCOUNT_ID = #{accountId})
        </if>
        <if test='alarmSch != null and alarmSch.equals("Y") and alarmLevel != null'>
	        <choose>
			<when test='alarmLevel == 9'>
			AND A.THREAT_IMPORTANCE IN (1,3,5)
			</when>
			<when test='alarmLevel == 8'>
			AND A.THREAT_IMPORTANCE IN (3,5)
			</when>
			<when test='alarmLevel == 6'>
			AND A.THREAT_IMPORTANCE IN (1,5)
			</when>
			<when test='alarmLevel == 4'>
			AND A.THREAT_IMPORTANCE IN (1,3)
			</when>
			<otherwise>
			AND A.THREAT_IMPORTANCE = #{alarmLevel}
			</otherwise>
			</choose>
		</if>
		<if test='warningSch != null and warningSch.equals("Y") and warningLevel != null'>
	        <choose>
			<when test='warningLevel == 9'>
			AND A.THREAT_IMPORTANCE IN (1,3,5)
			</when>
			<when test='warningLevel == 8'>
			AND A.THREAT_IMPORTANCE IN (3,5)
			</when>
			<when test='warningLevel == 6'>
			AND A.THREAT_IMPORTANCE IN (1,5)
			</when>
			<when test='warningLevel == 4'>
			AND A.THREAT_IMPORTANCE IN (1,3)
			</when>
			<otherwise>
			AND A.THREAT_IMPORTANCE = #{warningLevel}
			</otherwise>
			</choose>
		</if>
        AND  NOT EXISTS (SELECT B.THREAT_ID FROM threat_analysis B WHERE B.THREAT_ID = A.THREAT_ID)
        </where>
        ORDER BY A.THREAT_ID DESC
        <if test='login != null and !login.equals("")'>
        LIMIT 1
        </if>
  </select>

   <select id="selectWatchAssetList" parameterType="map" resultType="CmmnMap">
    	SELECT A.DETECTION_TIME
    	     , B.SMALL_CATEGORY
    	     , C.statusText REASON_NAME
    	     , B.ASSET_ID
        FROM asset_status_info A
        INNER JOIN network_asset_info B
        ON A.SYSTEM_ID = B.SYSTEM_ID
        LEFT JOIN reason_v C
        ON    A.SYSTEM_ID = C.systemId AND A.REASON_ID = C.statusCode
		WHERE A.ASSET_STATUS != 2
		<if test='login == null or login.equals("")'>
        AND A.DETECTION_TIME >= (SELECT LAST_SUCCESS_ACCESS_DATE FROM account_status WHERE ACCOUNT_ID = #{accountId})
        </if>
         <if test='alarmSch != null and alarmSch.equals("Y") and alarmLevel != null'>
        <choose>
		<when test='alarmLevel == 9'>
		AND 1 = 1
		</when>
		<when test='alarmLevel == 8'>
		AND (B.CONFIDENTIALITY_LEVEL > 1 OR B.INTEGRITY_LEVEL > 1 OR B.AVAILABILITY_LEVEL > 1)
		</when>
		<when test='alarmLevel == 6'>
		AND (B.CONFIDENTIALITY_LEVEL IN (1,5) OR B.INTEGRITY_LEVEL IN (1,5) OR B.AVAILABILITY_LEVEL IN (1,5))
		</when>
		<when test='alarmLevel == 4'>
		AND (B.CONFIDENTIALITY_LEVEL IN (1,3) OR B.INTEGRITY_LEVEL IN (1,3) OR B.AVAILABILITY_LEVEL IN (1,3))
		</when>
		<otherwise>
		AND (B.CONFIDENTIALITY_LEVEL = #{alarmLevel} OR B.INTEGRITY_LEVEL = #{alarmLevel} OR B.AVAILABILITY_LEVEL = #{alarmLevel})
		</otherwise>
		</choose>
		</if>
		<if test='warningSch != null and warningSch.equals("Y") and warningLevel != null'>
        <choose>
		<when test='alarmLevel == 9'>
		AND 1 = 1
		</when>
		<when test='alarmLevel == 8'>
		AND (B.CONFIDENTIALITY_LEVEL > 1 OR B.INTEGRITY_LEVEL > 1 OR B.AVAILABILITY_LEVEL > 1)
		</when>
		<when test='alarmLevel == 6'>
		AND (B.CONFIDENTIALITY_LEVEL IN (1,5) OR B.INTEGRITY_LEVEL IN (1,5) OR B.AVAILABILITY_LEVEL IN (1,5))
		</when>
		<when test='alarmLevel == 4'>
		AND (B.CONFIDENTIALITY_LEVEL IN (1,3) OR B.INTEGRITY_LEVEL IN (1,3) OR B.AVAILABILITY_LEVEL IN (1,3))
		</when>
		<otherwise>
		AND (B.CONFIDENTIALITY_LEVEL = #{alarmLevel} OR B.INTEGRITY_LEVEL = #{alarmLevel} OR B.AVAILABILITY_LEVEL = #{alarmLevel})
		</otherwise>
		</choose>
		</if>
		ORDER BY B.ASSET_ID DESC
        <if test='login != null and !login.equals("")'>
        LIMIT 1
        </if>
  </select>

   <select id="selectWatchReportList" parameterType="map" resultType="CmmnMap">
        SELECT A.CREATE_TIME
             , B.SCHEDULE_TITLE
             , C.REPORT_TITLE
             , C.REPORT_TYPE
             , A.MANAGE_ID
         FROM  report_manage A
         INNER JOIN report_schedule B
         ON A.SCHEDULE_ID = B.SCHEDULE_ID
         INNER JOIN report_form C
         ON A.FORM_ID = C.FORM_ID
         <where>
         AND A.PRINT_YN = 0
         AND B.ACCOUNT_ID = #{accountId}
         </where>
         ORDER BY A.MANAGE_ID DESC
         <if test='login != null and !login.equals("")'>
         LIMIT 1
         </if>
   </select>

  <select id="selectSatelliteTrans" parameterType="map" resultType="CmmnMap">

     	SELECT  *
     	FROM satellite_trans
     	LIMIT 1

  </select>

  <select id="selectCscStatus" parameterType="map" resultType="long">

     	SELECT  COUNT(1)
     	FROM csc_status
     	WHERE STATUS = 1

  </select>

  <select id="selectThreatImportanceGrade" parameterType="map" resultType="String">
      SELECT THREAT_IMPORTANCE_GRADE FROM satellite_trans LIMIT 1
  </select>

  <select id="selectTransmitData" parameterType="map" resultType="CmmnMap">
		SELECT T1.THREAT_ID
		     , T1.UNIT_ID
		     , T1.SHIP_ID
		     , UNIX_TIMESTAMP(T1.DETECTION_TIME) DETECTION_TIME
		     , T1.SRC_IP
		     , T1.DST_IP
		     , T1.SRC_PORT
		     , T1.DST_PORT
		     , T1.PROTOCOL
		     , T1.PAYLOAD_SIZE
		     , T1.FRAGMENTATION
		     , T1.FRAGMENT_ID
		     , T1.DETECTION_THREAT_NAME
		     , T1.THREAT_DETECTION_METHOD
		     , T1.THREAT_IMPORTANCE
		     , T1.PAYLOAD
		FROM threat_info T1
		<where>
		<choose>
		<when test='threatImportanceGrade != null and threatImportanceGrade.equals("9")'>
		AND THREAT_IMPORTANCE IN (1,3,5)
		</when>
		<when test='threatImportanceGrade != null and threatImportanceGrade.equals("8")'>
		AND THREAT_IMPORTANCE IN (3,5)
		</when>
		<when test='threatImportanceGrade != null and threatImportanceGrade.equals("6")'>
		AND THREAT_IMPORTANCE IN (1,5)
		</when>
		<when test='threatImportanceGrade != null and threatImportanceGrade.equals("4")'>
		AND THREAT_IMPORTANCE IN (1,3)
		</when>
		<otherwise>
		AND THREAT_IMPORTANCE = #{threatImportanceGrade}
		</otherwise>
		</choose>
		AND NOT EXISTS (SELECT T2.THREAT_ID FROM transmit_data T2 WHERE T2.THREAT_ID = T1.THREAT_ID)
		</where>
		ORDER BY T1.THREAT_ID
		LIMIT 1
  </select>

  <select id="selectSendTransmitData" parameterType="map" resultType="CmmnMap">
		SELECT A.DATA_ID
		     , B.THREAT_ID
		     , B.UNIT_ID
		     , B.SHIP_ID
		     , UNIX_TIMESTAMP(B.DETECTION_TIME) DETECTION_TIME
		     , B.SRC_IP
		     , B.DST_IP
		     , B.SRC_PORT
		     , B.DST_PORT
		     , B.PROTOCOL
		     , B.PAYLOAD_SIZE
		     , B.FRAGMENTATION
		     , B.FRAGMENT_ID
		     , B.DETECTION_THREAT_NAME
		     , B.THREAT_DETECTION_METHOD
		     , B.THREAT_IMPORTANCE
		     , B.PAYLOAD
		FROM transmit_data A
		INNER JOIN threat_info B
		ON    A.THREAT_ID = B.THREAT_ID
		AND A.SRC_FLAG = 0
		ORDER BY A.DATA_ID
		LIMIT 1
  </select>

  <select id="selectNavyTransmitData" parameterType="HashMap" resultType="CmmnMap">

        SELECT DATA_ID
             , COLLECTION_TIME
             , SRC_DATA
             , SRC_FLAG
             , SRC_BYTES
        FROM transmit_data
        <where>
        <choose>
			<when test='messageType == 1'>
			AND SRC_DATA LIKE '%asset_status%'
			</when>
			<when test='messageType == 2'>
			AND SRC_DATA LIKE '%detection_time%'
			</when>
			<otherwise>
			AND SRC_DATA LIKE '%equip_status%'
			</otherwise>
		</choose>
		AND SRC_FLAG = 0
		ORDER BY DATA_ID
		LIMIT 1
        </where>
        
     
  </select>
  
  
  <select id="selectNetworkEquipmentStatus" parameterType="map" resultType="CmmnMap">
		SELECT ID
		     , DETECTION_TIME
		     , EQUIP_STATUS_ID
		FROM network_equipment_status
		ORDER BY ID
  </select>


   <update id="insertTransmitData" parameterType="map">
         INSERT INTO transmit_data(COLLECTION_TIME
                                  , SRC_TIME
                                  , SRC_FLAG
                                  , THREAT_ID
                                  , SRC_BYTES)
					        VALUES( FROM_UNIXTIME(#{detectionTime})
					              , SYSDATE()
					              , 1
					              , #{threatId}
					              , #{srcBytes})
   </update>

    <update id="updateTransmitData" parameterType="map">
         UPDATE transmit_data SET SRC_TIME = SYSDATE()
                                , SRC_FLAG  = 1
                                , SRC_BYTES = #{srcBytes}
         WHERE DATA_ID = #{dataId}
   </update>


  <update id="insertWhiteList" parameterType="map">
       INSERT INTO whitelist_policy(POLICY_NAME
                                  , SRC_IP
                                  , SRC_MASK
                                  , DST_IP
                                  , DST_MASK
                                  , SRC_START_PORT
                                  , SRC_END_PORT
                                  , DST_START_PORT
                                  , DST_END_PORT
                                  , PROTOCOL
                                  , POLICY)
					        VALUES( #{policyName}
					              , #{srcIp}
					              , #{srcMask}
					              , #{dstIp, jdbcType=VARCHAR}
					              , #{dstMask}
					              , #{srcStartPort}
					              , #{srcEndPort}
					              , #{dstStartPort}
					              , #{dstEndPort}
					              , #{protocol}
					              , #{policy} )

  </update>

  <update id="updateWhiteList" parameterType="map">
       UPDATE whitelist_policy SET SRC_IP  = #{srcIp}
					              , SRC_MASK = #{srcMask}
					              , DST_IP = #{dstIp}
					              , DST_MASK = #{dstMask}
					              , SRC_START_PORT = #{srcStartPort}
					              , SRC_END_PORT = #{srcEndPort}
					              , DST_START_PORT = #{srcStartPort}
					              , DST_END_PORT = #{dstEndPort}
					              , PROTOCOL = #{protocol}
					              , POLICY = #{policy}
       WHERE POLICY_ID = #{policyId}

  </update>

  <update id="insertWhiteListNcos" parameterType="map">
       INSERT INTO whitelist_policy(POLICY_NAME
                                  , SRC_IP
                                  , SRC_MASK
                                  , DST_IP
                                  , DST_MASK
                                  , SRC_START_PORT
                                  , SRC_END_PORT
                                  , DST_START_PORT
                                  , DST_END_PORT
                                  , PROTOCOL
                                  , POLICY
                                  , POLICY_INTEGRITY)
					        VALUES( #{policyName}
					              , #{srcIpEnc}
					              , #{srcMask}
					              , #{dstIpEnc, jdbcType=VARCHAR}
					              , #{dstMask}
					              , #{srcStartPort}
					              , #{srcEndPort}
					              , #{dstStartPort}
					              , #{dstEndPort}
					              , #{protocol}
					              , #{policy} 
					              , #{integrity})

  </update>

  <update id="updateWhiteListNcos" parameterType="map">
       UPDATE whitelist_policy SET  SRC_IP  			= #{srcIpEnc}
					              , SRC_MASK 			= #{srcMask}
					              , DST_IP 				= #{dstIpEnc}
					              , DST_MASK 			= #{dstMask}
					              , SRC_START_PORT 		= #{srcStartPort}
					              , SRC_END_PORT 		= #{srcEndPort}
					              , DST_START_PORT 		= #{srcStartPort}
					              , DST_END_PORT 		= #{dstEndPort}
					              , PROTOCOL 			= #{protocol}
					              , POLICY 				= #{policy}
					              , POLICY_INTEGRITY 	= #{integrity}
       WHERE POLICY_ID = #{policyId}

  </update>
  
  <delete id="deleteWhiteList" parameterType="map">
       DELETE FROM  whitelist_policy
       WHERE POLICY_ID IN
       <foreach collection="list" item="row" open="(" close=")" separator=",">
       <foreach collection="row" item="col" index="key">
         <if test='key.equals("id")'>
            #{col}
         </if>
	   </foreach>
       </foreach>
  </delete>


  <update id="insertLinkInfo" parameterType="map">
		INSERT INTO link_info(LINK_ID
		                    ,  UPPER_LINK_ID
		                    , ASSET_ID
                              )
				        VALUES( #{id}
				              , #{upperId}
				              , #{assetId} )
   </update>

   <delete id="deleteLinkInfo" parameterType="map">
       DELETE FROM  LINK_INFO

  </delete>

   <update id="updateWhitePolicyList" parameterType="map">
       DELETE FROM  whitelist_policy
       WHERE POLICY_ID IN
       <foreach collection="list" item="row" open="(" close=")" separator=",">
       <foreach collection="row" item="col" index="key">
         <if test='key.equals("id")'>
            #{col}
         </if>
	   </foreach>
       </foreach>
  </update>


  <insert id="insertAlarmCheck" parameterType="map">
        INSERT INTO alarm_check ( ALARM_ID
                               , ACCOUNT_ID
                               , CONFIRM_TIME
                               )
        SELECT A.ALARM_ID,#{accountId},SYSDATE()
        FROM alarm_list A
     	LEFT JOIN alarm_check B
     	ON A.ALARM_ID = B.ALARM_ID
     	AND B.ACCOUNT_ID = #{accountId}
     	WHERE B.CHECK_ID IS NULL
     <!--   INSERT INTO ALARM_CHECK ( ALARM_ID
                               , ACCOUNT_ID
                               , CONFIRM_TIME
                               )
                        VALUES ( #{alarmId}
                               , #{accountId}
                               , SYSDATE()
                               )  -->

  </insert>

  <update id="updateCyberDefense" parameterType="map">
       UPDATE cyber_defense SET CYBER_DEF_GRADE  = #{cyberDefGrade}
  </update>

   <update id="insertSatelliteTrans" parameterType="map">
       INSERT INTO satellite_trans(SETTING_TIME
                                  , SETTER
                                  , TRANS_SPEED
                                  , SYSTEM_OP_STATUS
                                  , SYSTEM_OP_STATUS_DELAY
                                  , UNIT_ID
                                  , SHIP_ID
                                  , ASSET_STATUS
                                  , THREAT_IMPORTANCE_GRADE
                                  , DETECTION_TIME
                                  , SRC_IP
                                  , DST_IP
                                  , SRC_PORT
                                  , DST_PORT
                                  , PROTOCOL
                                  , PAYLOAD_SIZE
                                  , FRAGMENTATION
                                  , FRAGMENT_ID
                                  , DETECTION_THREAT_NAME
                                  , THREAT_DETECTION_METHOD
                                  , THREAT_IMPORTANCE
                                  , PAYLOAD
                                   )
					        VALUES( SYSDATE()
					              , #{setter}
					              , #{transSpeed}
					              , #{systemOpStatus}
					              , #{systemOpStatusDelay}
					              , #{unitId}
					              , #{shipId}
					              , #{assetStatus}
					              , #{threatImportanceGrade}
					              , #{detectionTime}
					              , #{srcIp}
					              , #{dstIp}
					              , #{srcPort}
					              , #{dstPort}
					              , #{protocol}
					              , #{payloadSize}
					              , #{fragmentation}
					              , #{fragmentId}
					              , #{detectionThreatName}
					              , #{threatDetectionMethod}
					              , #{threatImportance}
					              , #{payload} )

  </update>

  <update id="updateSatelliteTrans" parameterType="map">
       UPDATE satellite_trans SET SETTING_TIME  = SYSDATE()
					              , SETTER = #{setter}
                                  , TRANS_SPEED  = #{transSpeed}
                                  , SYSTEM_OP_STATUS = #{systemOpStatus}
                                  , SYSTEM_OP_STATUS_DELAY = #{systemOpStatusDelay}
                                  , UNIT_ID = #{unitId}
                                  , SHIP_ID = #{shipId}
                                  , ASSET_STATUS = #{assetStatus}
                                  , THREAT_IMPORTANCE_GRADE = #{threatImportanceGrade}
                                  , DETECTION_TIME = #{detectionTime}
                                  , SRC_IP = #{srcIp}
                                  , DST_IP = #{dstIp}
                                  , SRC_PORT = #{srcPort}
                                  , DST_PORT = #{dstPort}
                                  , PROTOCOL = #{protocol}
                                  , PAYLOAD_SIZE = #{payloadSize}
                                  , FRAGMENTATION = #{fragmentation}
                                  , FRAGMENT_ID = #{fragmentId}
                                  , DETECTION_THREAT_NAME = #{detectionThreatName}
                                  , THREAT_DETECTION_METHOD = #{threatDetectionMethod}
                                  , THREAT_IMPORTANCE = #{threatImportance}
                                  , PAYLOAD = #{payload}
       WHERE SETTING_ID = #{settingId}

  </update>

   <update id="insertSatelliteTransNcos" parameterType="map">
       INSERT INTO satellite_trans(SETTING_TIME
                                  , SETTER
                                  , TRANS_SPEED
                                  , SYSTEM_OP_STATUS
                                  , SYSTEM_OP_STATUS_DELAY
                                  , UNIT_ID
                                  , SHIP_ID
                                  , ASSET_STATUS
                                  , THREAT_IMPORTANCE_GRADE
                                  , DETECTION_TIME
                                  , SRC_IP
                                  , DST_IP
                                  , SRC_PORT
                                  , DST_PORT
                                  , PROTOCOL
                                  , PAYLOAD_SIZE
                                  , FRAGMENTATION
                                  , FRAGMENT_ID
                                  , DETECTION_THREAT_NAME
                                  , THREAT_DETECTION_METHOD
                                  , THREAT_IMPORTANCE
                                  , PAYLOAD
                                  , SATELLITE_INTEGRITY
                                   )
					        VALUES( STR_TO_DATE(#{settingTime}, '%Y-%m-%d %H:%i.%s')
					              , #{setter}
					              , #{transSpeed}
					              , #{systemOpStatus}
					              , #{systemOpStatusDelay}
					              , #{unitId}
					              , #{shipId}
					              , #{assetStatus}
					              , #{threatImportanceGrade}
					              , #{detectionTime}
					              , #{srcIp}
					              , #{dstIp}
					              , #{srcPort}
					              , #{dstPort}
					              , #{protocol}
					              , #{payloadSize}
					              , #{fragmentation}
					              , #{fragmentId}
					              , #{detectionThreatName}
					              , #{threatDetectionMethod}
					              , #{threatImportance}
					              , #{payload}
					              , #{integrity} )

  </update>

  <update id="updateSatelliteTransNcos" parameterType="map">
       UPDATE satellite_trans SET SETTING_TIME  = STR_TO_DATE(#{settingTime}, '%Y-%m-%d %H:%i.%s')
					              , SETTER = #{setter}
                                  , TRANS_SPEED  = #{transSpeed}
                                  , SYSTEM_OP_STATUS = #{systemOpStatus}
                                  , SYSTEM_OP_STATUS_DELAY = #{systemOpStatusDelay}
                                  , UNIT_ID = #{unitId}
                                  , SHIP_ID = #{shipId}
                                  , ASSET_STATUS = #{assetStatus}
                                  , THREAT_IMPORTANCE_GRADE = #{threatImportanceGrade}
                                  , DETECTION_TIME = #{detectionTime}
                                  , SRC_IP = #{srcIp}
                                  , DST_IP = #{dstIp}
                                  , SRC_PORT = #{srcPort}
                                  , DST_PORT = #{dstPort}
                                  , PROTOCOL = #{protocol}
                                  , PAYLOAD_SIZE = #{payloadSize}
                                  , FRAGMENTATION = #{fragmentation}
                                  , FRAGMENT_ID = #{fragmentId}
                                  , DETECTION_THREAT_NAME = #{detectionThreatName}
                                  , THREAT_DETECTION_METHOD = #{threatDetectionMethod}
                                  , THREAT_IMPORTANCE = #{threatImportance}
                                  , PAYLOAD = #{payload}
                                  , SATELLITE_INTEGRITY = #{integrity}
       WHERE SETTING_ID = #{settingId}

  </update>
  <select id="selectIntegritySalt" parameterType="map" resultType="CmmnMap">
	  SELECT ACCOUNT_SETTINGS
	       , SATELLITE_TRANS
	       , THREAT_ANALYSIS
		   , USER_ACTION
		   , WHITELIST_POLICY
	  FROM INTEGRITY_SALT
	  LIMIT 1
  </select>


</mapper>