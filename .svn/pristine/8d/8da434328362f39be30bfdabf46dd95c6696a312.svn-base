<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{th/cmmn/layout}">
<head>
<title>시스템설정</title>
</head>
<th:block layout:fragment="content">
<div class="container-wide">
	<div class="container">
		<div class="grid-row">
			<div class="item-box col-12">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_12_01"></span><strong>시스템설정</strong></h4>
				</div>
			</div>
		</div>
		<div class="grid-row">
			<div class="item-box col-12">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_search"></span><strong>조회조건</strong></h4>
					<div class="items" style="overflow: visible">
						<!-- item contnets // -->
						<div class="schwrap">
							<ul>
								<li>
								    <div  class="selectWrap">소속
									    <div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schAffiliationId" class="checkboxes" style="display:none;">
												
											</div>
										</div> 
									</div>
								</li>
								<li>
									<div  class="selectWrap">계급
									    <div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schClassId" class="checkboxes" style="display:none;">
												
											</div>
										</div> 
									</div>
								</li>
								<li>
									<label>사용자명
										<input type="text" id="schUsername" class="form-control korEng" placeholder="사용자명을 입력하세요">
									</label>
								</li>
							</ul>
							<button class="btn medium darkblue schBtn"><span class="iconBtn icon_btn_01"></span><strong>검색</strong></button>
						</div>
						<!-- // item contnets --> 
					</div>
				</div>
			</div>
		</div>
		<div class="grid-row">
			<div class="item-box col-12">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_list"></span><strong>조회목록</strong></h4>
					<div class="items"> 
						<!--table//-->
						<div class="tablewrap">
							<table>
								<thead class="tHead">
								    <tr>
								        <th rowspan="2" class="displayNone" style="display:none;">id</th>
								        <th rowspan="2" class="displayNone" style="display:none;">accountId</th>
										<th rowspan="2">소속</th>
										<th rowspan="2">계급</th>
										<th rowspan="2">사용자명</th>
									    <th rowspan="2">알람설정</th>
										<th rowspan="2">경보설정</th>
										<th rowspan="2">세션통제설정</th>
										<th colspan="3">알람설정</th>
										<th colspan="3">경보설정</th>
										<th rowspan="2">설정적용</th>
									</tr>
									<tr>
										<th>상</th>
										<th>중</th>
										<th>하</th>
										<th>상</th>
										<th>중</th>
										<th>하</th>
									</tr>
								</thead>
								<tbody class="tBody">
								</tbody>
							</table>
						</div>
						<div class="page_wrap">
							<div class="page_nation"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--//Grid--> 
	</div>
</div>
<script th:inline="javascript"> 
	window.addEventListener('DOMContentLoaded', () => {
		   init();
		   
	});
   
    const init = () => {

    	createMultiChk(document.getElementById('schAffiliationId'),'COUT');
    	createMultiChk(document.getElementById('schClassId'),'URGR');
		pageInit(document.querySelector(".page_nation"),searchFunc,page.rowPerPage);
		searchFunc();
    }
    
    const searchFunc = (invoker) => {
    	const compPageNum = document.querySelector(".page_nation").querySelector('.compPageNum'); 
    	if(invoker != undefined && invoker != null){
    		compPageNum.setAttribute("value",1);
    	}
    	let param = { "pageNo" : compPageNum.getAttribute("value")
        			, "rowPerPage" : page.rowPerPage
        			};
    	gfn_asyncJsonCall('/getConfList','POST',param).then((data) => {
    		let list = null;
    		let appendData = {};
    		let pageInfo = null;
    		for(let key in data) {
    			if(key.indexOf("list") > -1){
    				list = data[key];
    	 		}
    			if(key.indexOf("appendData") > -1){
    				appendData = data[key];
    	 		}
    	        if(key.indexOf('pageInfo') > -1){
    	          	pageInfo = data[key];
    	  		}
    	      
    		}
    		let tBody = document.querySelector(".tablewrap").querySelector('.tBody');
			while(tBody.hasChildNodes())
			{
				tBody.removeChild( tBody.firstChild );       
			}

	        for(let key in list){
	        	let tr = document.createElement('TR');
	        	let item = list[key];
	        	let tdId = document.createElement('TD');
	        	tdId.classList.add('displayNone');
	        	tdId.setAttribute("data-id",'settingId');
	        	tdId.setAttribute("data-value",gfn_nullValue(item['id']));
	        	tdId.style.display = 'none';
	        	tr.appendChild(tdId);
	        	
	        	let tdAccountId = document.createElement('TD');
	        	tdAccountId.classList.add('displayNone');
	        	tdAccountId.setAttribute("data-id",'accountId');
	        	tdAccountId.setAttribute("data-value",gfn_nullValue(item['accountId']));
	        	tdAccountId.style.display = 'none';
	        	tr.appendChild(tdAccountId);
	        	
	        	let td1 = document.createElement('TD');
	        	td1.setAttribute("data-id",'affiliationId');
	        	td1.setAttribute("data-value",gfn_nullValue(item['affiliationId']));
	        	td1.append(gfn_getCodeVal('COUT',gfn_nullValue(item['affiliationId'])));
	        	tr.appendChild(td1);
	        	let td2 = document.createElement('TD');
	        	td2.setAttribute("data-id",'classId');
	        	td2.setAttribute("data-value",gfn_nullValue(item['classId']));
	        	td2.append(gfn_getCodeVal('URGR',gfn_nullValue(item['classId'])));
	        	tr.appendChild(td2);
	        	let td3 = document.createElement('TD');
	        	td3.setAttribute("data-id",'username');
	        	td3.setAttribute("data-value",gfn_nullValue(item['username']));
	        	td3.append(gfn_nullValue(item['username']));
	        	tr.appendChild(td3);
	    
	        	let chkTd = document.createElement('TD');
	        	chkTd.setAttribute("data-id",'alarmStatus');
	        	let chkbox = document.createElement('input');
				chkbox.setAttribute("type", "checkbox");
				if(gfn_nullValue(item["alarmStatus"]) == '1'){
					chkbox.checked = true;
				}
				chkTd.appendChild(chkbox);
	        	tr.appendChild(chkTd);
	        	
	        	let chkTd0 = document.createElement('TD');
	        	chkTd0.setAttribute("data-id",'warningStatus');
	        	let chkbox0 = document.createElement('input');
				chkbox0.setAttribute("type", "checkbox");
				if(gfn_nullValue(item["warningStatus"]) == '1'){
					chkbox0.checked = true;
				}
				chkTd0.appendChild(chkbox0);
	        	tr.appendChild(chkTd0);
	   
	        	let chkTd1 = document.createElement('TD');
	        	chkTd1.setAttribute("data-id",'sessionControlStatus');
	        	let chkbox1 = document.createElement('input');
				chkbox1.setAttribute("type", "checkbox");
				if(gfn_nullValue(item["sessionControlStatus"]) == '1'){
					chkbox1.checked = true;
				}
				chkTd1.appendChild(chkbox1);
	        	tr.appendChild(chkTd1);
	        	
	        	let chkTd2 = document.createElement('TD');
	        	chkTd2.setAttribute("data-id",'alarmLevelH');
	        	let chkbox2 = document.createElement('input');
				chkbox2.setAttribute("type", "checkbox");
				chkTd2.appendChild(chkbox2);
	        	tr.appendChild(chkTd2);
	        	
	        	let chkTd3 = document.createElement('TD');
	        	chkTd3.setAttribute("data-id",'alarmLevelM');
	        	let chkbox3 = document.createElement('input');
				chkbox3.setAttribute("type", "checkbox");
				chkTd3.appendChild(chkbox3);
	        	tr.appendChild(chkTd3);
	        	
	        	let chkTd4 = document.createElement('TD');
	        	chkTd4.setAttribute("data-id",'alarmLevelL');
	        	let chkbox4 = document.createElement('input');
				chkbox4.setAttribute("type", "checkbox");
				chkTd4.appendChild(chkbox4);
	        	tr.appendChild(chkTd4);
	        	
	        	let chkTd5 = document.createElement('TD');
	        	chkTd5.setAttribute("data-id",'warningLevelH');
	        	let chkbox5 = document.createElement('input');
	        	chkbox5.setAttribute("type", "checkbox");
				chkTd5.appendChild(chkbox5);
	        	tr.appendChild(chkTd5);
	        	
	        	let chkTd6 = document.createElement('TD');
	        	chkTd6.setAttribute("data-id",'warningLevelM');
	        	let chkbox6 = document.createElement('input');
				chkbox6.setAttribute("type", "checkbox");
				chkTd6.appendChild(chkbox6);
	        	tr.appendChild(chkTd6);
	        	
	        	let chkTd7 = document.createElement('TD');
	        	chkTd7.setAttribute("data-id",'warningLevelL');
	        	let chkbox7 = document.createElement('input');
				chkbox7.setAttribute("type", "checkbox");
				chkTd7.appendChild(chkbox7);
	        	tr.appendChild(chkTd7);
	        	if(gfn_nullValue(item["alarmLevel"]) == '9'){
					chkbox2.checked = true;
					chkbox3.checked = true;
					chkbox4.checked = true;
				}
	        	else if(gfn_nullValue(item["alarmLevel"]) == '8'){
	        		chkbox2.checked = true;
					chkbox3.checked = true;
				}
	        	else if(gfn_nullValue(item["alarmLevel"]) == '6'){
	        		chkbox2.checked = true;
					chkbox4.checked = true;
				}
	        	else if(gfn_nullValue(item["alarmLevel"]) == '5'){
	        		chkbox2.checked = true;
				}
	        	else if(gfn_nullValue(item["alarmLevel"]) == '4'){
	        		chkbox3.checked = true;
					chkbox4.checked = true;
				}
	        	else if(gfn_nullValue(item["alarmLevel"]) == '3'){
	        		chkbox3.checked = true;
				}
	        	else if(gfn_nullValue(item["alarmLevel"]) == '1'){
					chkbox4.checked = true;
				}
	        	if(gfn_nullValue(item["warningLevel"]) == '9'){
					chkbox5.checked = true;
					chkbox6.checked = true;
					chkbox7.checked = true;
				}
	        	else if(gfn_nullValue(item["warningLevel"]) == '8'){
	        		chkbox5.checked = true;
					chkbox6.checked = true;
				}
	        	else if(gfn_nullValue(item["warningLevel"]) == '6'){
					chkbox5.checked = true;
					chkbox7.checked = true;
				}
	        	else if(gfn_nullValue(item["warningLevel"]) == '5'){
					chkbox5.checked = true;
				}
	        	else if(gfn_nullValue(item["warningLevel"]) == '4'){
					chkbox6.checked = true;
					chkbox7.checked = true;
				}
	        	else if(gfn_nullValue(item["warningLevel"]) == '3'){
					chkbox6.checked = true;
				}
	        	else if(gfn_nullValue(item["warningLevel"]) == '1'){
					chkbox7.checked = true;
				}
	        	let btnTd = document.createElement('TD');
	        	let tdAnch = document.createElement('a');
				tdAnch.classList.add("btn","small","darkblue");
				tdAnch.setAttribute("title", "적용");
				tdAnch.setAttribute("href", "");
	
				const tdSpan = document.createElement('span');
				tdSpan.classList.add('iconBtn','icon_btn_06');
				const tdStrong = document.createElement('strong');
				tdStrong.append('적용');
				tdAnch.append(tdSpan);
				tdAnch.append(tdStrong);
				btnTd.appendChild(tdAnch);
				tdAnch.addEventListener('click',(e) => {
					e.preventDefault();
					setBtn(tr);
				});
	        	tr.appendChild(btnTd);
	        	tBody.appendChild(tr);
	        }
    		pageBind(document.querySelector(".page_nation"),pageInfo,searchFunc);
    	}); 
    }
    
    const detailFunc = (data) => {
    	console.log("detailFunc data:",data);
    }
    
    const setBtn = (tr) => {
    	let jsonParam = {};
    	let alarmLevel = 0;
    	let warningLevel = 0;
    	const tds = tr.querySelectorAll('td');
    	tds.forEach((td,i) => {
    		if(i < 5){
    			jsonParam[td.getAttribute('data-id')] = td.getAttribute('data-value');
    		}
    	    else if(i === 5 || i === 6 || i === 7){
    	    	console.log(td);
    	    	if(td.children[0].checked){
    	    		jsonParam[td.getAttribute('data-id')] = 1;
    	    	}
    	    	else{
    	    		jsonParam[td.getAttribute('data-id')] = 0;
    	    	}
    		}
    		
    		else if(i === 8){
    			if(td.children[0].checked) alarmLevel +=5;
    		}
			else if(i === 9){
				if(td.children[0].checked) alarmLevel +=3;			
			}
			else if(i === 10){
				if(td.children[0].checked) alarmLevel +=1;		
			}
			else if(i === 11){
				if(td.children[0].checked) warningLevel +=5;
			}
            else if(i === 12){
            	if(td.children[0].checked) warningLevel +=3;
			}
            else if(i === 13){
            	if(td.children[0].checked) warningLevel +=1;
			}		
    		
		});
    	jsonParam.alarmStatus = 0;
    	if(alarmLevel > 0){
    		jsonParam.alarmStatus = 1;
    	}
    	jsonParam.warningStatus = 0;
    	if(warningLevel > 0){
    		jsonParam.warningStatus = 1;
    	}
    	jsonParam.alarmLevel = alarmLevel;
    	jsonParam.warningLevel = warningLevel;
    	gfn_asyncTranDataCall('/saveEnvConf','POST',jsonParam,searchFunc,true);
    }
    
    document.querySelector('.schBtn').addEventListener('click',(e) => {
    	e.preventDefault();
    	searchFunc();
    });
</script>
</th:block>
</html>
