<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{th/cmmn/layout}">
<head>
<title>자산상태전시</title>
</head>
<th:block layout:fragment="content">
<div class="container-wide">
	<div class="container">
		<div class="grid-row">
			<div class="item-box col-12">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_09_01"></span><strong>자산 상태 전시</strong></h4>
				</div>
			</div>
		</div>
		<div class="grid-row">
			<div class="item-box col-2">
				<div class="inner mainInner">
					<h4 class="item-title"><span class="iconWrapB icon_09_02"></span><strong>자산 상태</strong></h4>
					<div class="items"><div class="dataNum ac" style="margin-top: 60px"></div></div>
				</div>
			</div>
			<div class="item-box col-2">
				<div class="inner mainInner2">
					<h4 class="item-title"><span class="iconWrapB icon_09_03"></span><strong>자산 종류별 발생 현황</strong></h4>
					<div class="items" style="overflow:hidden">
					<div class="assetNormal ac" style="margin-top: 60px; display:none;"></div>
					<div class="assetItm1" style="margin:43px 10px 0px 40px;display:none;">
					<span style="color: #80e080;font-size:20px;">●</span>
					<strong style="vertical-align:center">서버&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>
					<span style="color: #4fc3f7;font-size:20px;">●</span>
					<strong>딘말</strong>
					</div>
					<div class="assetItm2" style="margin:5px 10px 0px 40px;display:none;">
					<span style="color: #9575cd;font-size:20px;">●</span>
					<strong>네트워크 장비</strong>
					<span style="color: #c71585;font-size:20px;">●</span>
					<strong>보안장비</strong>
					</div>
					
					<span class="imgWrap" style="margin-top: 20px"><canvas id="donutChart" width="320" height="324"></canvas></span>
					</div>
				</div>
			</div>
			<div class="item-box col-8">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_09_04"></span><strong>탐지 시간</strong></h4>
					<div class="items"> <!-- item contnets // --><span class="imgWrap"><canvas id="lineChart" width="1603" height="330"></canvas></span><!-- // item contnets --> 
					</div>
				</div>
			</div>
		</div>
		<div class="grid-row">
			<div class="item-box col-12">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_search"></span><strong>조회조건</strong></h4>
					<div class="items" style="overflow: visible"> <!--20230403수정-->
						<!-- item contnets // -->
						<div class="schwrap">
							<ul>
								<li>
									<label>탐지시간
										<input id="frDt" type="datetime-local" data-placeholder="날짜 선택" value="" class="form-control">
										~
										<input id="toDt" type="datetime-local" data-placeholder="날짜 선택" value="" class="form-control">
									</label>
									<div  class="selectWrap">관리자
									    <div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schAdmin" class="checkboxes" style="display:none;">
											</div>
										</div> 
									</div>
								</li>
								<li>
									<div  class="selectWrap" style="z-index:200;">대분류
									    <div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schLargeCategory" class="checkboxes" style="display:none;">
											</div>
										</div> 
									</div>
									<div class="selectWrap">기밀성 중요도
									    <div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schConfidentialityLevel" class="checkboxes" style="display:none;">
											</div>
										</div> 
									</div>
								</li>
								<li>
									<div class="selectWrap" style="z-index:200;">소분류
										<div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schSmallCategory" class="checkboxes" style="display:none;">
											</div>
										</div>
									</div>
									<div class="selectWrap">무결성 중요도
										<div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schIntegrityLevel" class="checkboxes" style="display:none;">
											</div>
										</div>
									</div>
								</li>
								<li>
									<label>IP 주소
										<input id="schIpAddress" type="text" class="form-control" placeholder="192.168.100.201" >
									</label>
									<div class="selectWrap">가용성 중요도
										<div class="multiselect" >
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect" ></div>
											</div>
											<div id="schAvailablityLevel" class="checkboxes" style="display:none;">
											</div>
										</div>
									</div>
								</li>
								<li>
								    <div class="selectWrap" style="z-index:200" >구역
										<div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schZoneId" class="checkboxes" style="display:none;">
											</div>
										</div>
									</div>
									<div class="selectWrap">상태
										<div class="multiselect">
											<div class="selectBox">
												<div class="selected">
													<div class="selected-value">전체</div>
													<div class="arrow"></div>
												</div>
												<div class="overSelect"></div>
											</div>
											<div id="schStatus" class="checkboxes" style="display:none;">
											</div>
										</div>
									</div>
								</li>
							</ul>
							<div>
							<button class="btn medium darkblue initBtn"  title="초기화"><span class="iconBtn icon_reset"></span><strong>초기화</strong></button>
							<button class="btn medium darkblue schBtn" title="검색"><span class="iconBtn icon_btn_01"></span><strong>검색</strong></button>
							</div>
						</div>
						<!-- // item contnets --> 
					</div>
				</div>
			</div>
		</div>
		<div class="grid-row">
			<div class="item-box col-12">
				<div class="inner">
					<h4 class="item-title"><span class="iconWrapB icon_list"></span><strong>조회목록</strong>
					<a class="btn small darkblue totCnt" style="float:right;display:none;"><span class="iconBtn icon_btn_01"></span><strong id="cntVal"></strong></a>
					</h4>
					<div class="items" style="height:350px; overflow:hidden"> 
						<!--table//-->
						<div class="tablewrap">
							<table>
								<thead class="tHead">
								</thead>
								<tbody class="tBody">
								</tbody>
							</table>
						</div>
						<!--//table--> 
						<!--pagination//-->
						<div class="page_wrap">
							<div class="page_nation">
								<input type="hidden" name="rowPerPage" class="rowPerPage" value="5">
							</div>
						</div>
						<!--//pagination--> 
					</div>
				</div>
			</div>
		</div>
		<!--//Grid--> 
	</div>
</div>
<div class="dim-layer">
	<div class="dimBg"></div>
	<div id="assetList" class="pop-layer xxxxlarge">
		<!--Title-->
		<div class="Popup-title">
			<h3><strong>자산 상태 목록</strong></h3>
			<button class="icon-close">닫기</button>
		</div>
		<div class="Popup-container">
			<!--Contens-->
			<div class="grid-row">
				<div class="item-box col-4" style="padding:0 15px 15px 0;">
					<div class="inner popInner">
					    
						<h4 class="item-title"><span class="iconWrapB icon_09_02"></span><strong>자산 상태</strong></h4>
						<div class="items"><div class="dataNum ac" style="margin-top: 30px"></div> </div>
					</div>
				</div>
				<div class="item-box col-64"  style="padding:0 0 15px 0;">
					<div class="inner popInner2">
					     <h4 class="item-title"><span class="iconWrapB icon_09_03"></span><strong>자산 종류별 발생 현황</strong></h4>
					     <div class="items" style="overflow:hidden">
					     
					     <div class="assetNormal ac" style="margin-top: 60px; display:none;"></div>
					     
					     <div class="assetItm1" style="margin:33px 100px 15px 370px;display:none;">
					     <span style="color: #80e080;font-size:20px;">●</span>
				     	 <strong style="vertical-align:center">서버&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong>
				     	 <span style="color: #4fc3f7;font-size:20px;">●</span>
					     <strong>딘말</strong>
				     	 </div>
					     <div class="assetItm2" style="margin:5px 10px 15px 370px;display:none;">
					     <span style="color: #9575cd;font-size:20px;">●</span>
					     <strong>네트워크 장비</strong>
					     <span style="color: #c71585;font-size:20px;">●</span>
					     <strong>보안장비</strong>
				    	</div>
					
					    <span class="imgWrap"  style="margin: 0 0 5px 300px">
					    <canvas id="donutChartPop" width="390" height="200"></canvas>
					    </span>
				       </div>
					     
					<!-- 	<h4 class="item-title"><span class="iconWrapB icon_09_03"></span><strong>자산 종류별 발생 현황</strong></h4>
						
						<div class="items" style="overflow:hidden">
						<span class="imgWrap" style="margin: 0 0 5px 300px">
						<canvas id="donutChartPop" width="390" height="200"></canvas>
						</span>
						</div> -->
					</div>
				</div>
				<!-- <div class="item-box col-4" style="padding:0 0 15px 15px;">
					<div class="inner">
						<h4 class="item-title"><span class="iconWrapB icon_09_01"></span><strong>자산 상태 전시</strong></h4>
					</div>
				</div> -->
			</div>

			<div class="Popup-contents">
				<div class="tablewrap" style="height:450px; overflow:auto;">
					<table >
						<thead class="tHead">
						</thead>
						<tbody class="tBody" >
						</tbody>
					</table>
				</div>
<!-- 			    <input type="hidden" name="pageNo" class="pageNo" value="1">
				<input type="hidden" name="rowPerPage" class="rowPerPage" value="15"> -->
			</div>
		</div>
		<div class="Popup-footer">
		<div class="btnWrap">
		<div class="left"></div>
		<div class="right">
		    <!-- <a class="btn medium darkblue btnMore"><span class="iconBtn icon_btn_02"></span><strong>더 보기</strong></a> -->
			<a href="javascript:;" class="btn medium darkblue popClose"><span class="iconBtn icon_btn_08"></span><strong>닫기</strong></a>
		</div>
		</div>
		</div>
	</div>
</div>

<script th:inline="javascript"> 
	window.addEventListener('DOMContentLoaded', () => {
		document.querySelector('#donutChart').style.width = '290px';
		document.querySelector('#donutChart').style.height = '220px';
		document.querySelector('#lineChart').style.width = '1000px';
		document.querySelector('#lineChart').style.height = '200px';
		if(document.body.clientWidth > 1920 ){
			document.querySelector('#donutChart').style.width = '370px';
			document.querySelector('#donutChart').style.height = '324px';
			document.querySelector('#lineChart').style.width = '1603px';
			document.querySelector('#lineChart').style.height = '376px';
		}
		ncos.schMode = 'auto';
		init();
		ncos.intervalFunc = setInterval(searchFunc, ncos.interval);//50초
		document.querySelector('.initBtn').addEventListener('click',e => {
			e.preventDefault();
			ncos.initBtn = true;
			ncos.schMode = 'auto';
			gfn_initObj(document.querySelector('.schwrap'));
			searchFunc();
			ncos.intervalFunc = setInterval(searchFunc, ncos.interval);//50초
	    });	    
	    document.querySelector('.schBtn').addEventListener('click',e => {
	    	e.preventDefault();
	    	ncos.schMode = 'menual';
	    	clearInterval(ncos.intervalFunc);
	    	searchFunc(e.target);
	    });
		   
	});
	let donutChart = null;
	let donutChartPopup = null;
    let lineChart = null;
    let legendOption = {usePointStyle: true,
          	           color: 'black',
          	           padding : 30,   
                       font: {size: 12,}
	};
    
    const init = () => {
		uiMode = gfn_getStorage(ncos.uiMode);
        if(uiMode != 'white'){
        	legendOption.color = 'white';
        }
    	document.getElementById('frDt').value= gfn_getDiffDt(ncos.diffDay);
    	document.getElementById('toDt').value= gfn_getTodayDt();
    	createMultiChk(document.getElementById('schLargeCategory'),'ASLC');
    	createMultiChk(document.getElementById('schSmallCategory'),'ASSC');
    	createMultiChk(document.getElementById('schConfidentialityLevel'),'COIM');
    	createMultiChk(document.getElementById('schIntegrityLevel'),'COIM');
    	createMultiChk(document.getElementById('schAvailablityLevel'),'COIM');
    	createMultiChk(document.getElementById('schStatus'),'ASST');
    	gfn_getCodeManager().then((data) => {
    		createMultiChk(document.getElementById('schAdmin'),'AD', data.info);
    		//zoneData = data.info;
    		gfn_showChkVal(document.getElementById('schAdmin'));
    	});
    	gfn_getCodeZone().then((data) => {
    		createMultiChk(document.getElementById('schZoneId'),'ZNLS', data.zoneInfo);
    		//zoneData = data.zoneInfo;
    		gfn_showChkVal(document.getElementById('schZoneId'));
    	});
    	const headColumns = [{data_id:"rn",label:"No.",width:"60px"}
					        ,{data_id:"id",width: "0px"}
					        ,{data_id:"detectionTime",label: "탐지시간" ,data_dateFrmt:"yy-mm-dd hh:mi:ss"}
					        ,{data_id:"largeCategory",label:"대분류" ,data_grpCd:"ASLC"}
					        ,{data_id:"smallCategory",label:"소분류", data_grpCd:"ASSC"}
					        ,{data_id:"assetName",label:"자산명"}
					        ,{data_id:"ipAddress",label:"IP주소"}
					        ,{data_id:"zoneName",label:"구역"}
					        ,{data_id:"manager",label:"관리자", }
					        ,{data_id:"confidentialityLevel",label: "기밀성 중요도", data_grpCd:"COIMS",data_class:"threat" }
					        ,{data_id:"integrityLevel",label: "무결성 중요도", data_grpCd:"COIMS" ,data_class:"threat"}
					        ,{data_id:"availabilityLevel",label: "가용성 중요도", data_grpCd:"COIMS",data_class:"threat"}
					        ,{data_id:"assetStatus",label: "상태" ,data_grpCd:"ASST"}
					        ,{data_id:"statusText",label: "상태 메시지"}
					       ];
        gridInit(document.querySelector('.tablewrap'),headColumns);
		pageInit(document.querySelector(".page_nation"),searchFunc,page.rowPerPage);
		//alert("assetDisp.....");
		searchFunc();
    }
    
    const searchFunc = (invoker) => {
    	pageSearch("/getAssetDispList",document.querySelector(".tablewrap"),document.querySelector(".page_nation"),invoker,searchFunc,searchAfterFunc);
    }

    const searchAfterFunc = (appendData) => {
    	
    	if(ncos.schMode == 'menual'){
    		document.querySelector('.totCnt').style.display = '';
    		if(appendData.totCount > 0){
        		document.querySelector('.totCnt').setAttribute("href","javascript:searchAssetAllList();");
        	}
        	else{
        		document.querySelector('.totCnt').removeAttribute("href");
        	}
        	document.querySelector('#cntVal').textContent = '건수 : '+appendData.totCount+'';
    	}
    	else{
    		document.querySelector('.totCnt').style.display = 'none';
    		setStatus(appendData.assetStatus);
        	drawDonutChart(appendData.assetAffair);
        	drawLineChart(appendData.assetStatusList);
    	}
    
    }
    
    const setStatus = (data) => {
    	let dataNum = document.querySelector('.mainInner').querySelector('.dataNum');
    	dataNum.innerHTML = '';
    	dataNum.append(data.assetThreatCnt+'/'+data.assetTotCnt);

    }
    
    const drawDonutChart = (chartData) => {
    	//console.log("chartData:",chartData);
		const labels = new Array();
		const pcts = new Array();
		//gfn_getCodeVal('ASLC','1')
		let totCnt = 0;
		for(let key in chartData){
		   let item = chartData[key];
		   //console.log("item::::",item);
		   let category = gfn_getCodeVal('ASLC',item.largeCategory);
		   if(category == '서버'){
			   category = category+"               ";
		   }
		   if(category == '단말'){
			   category = category+"       ";
		   }
		   labels.push(category);
		   totCnt += item.cnt;
		}
		//totCnt = 3;
		document.querySelector('.mainInner2').querySelector('.assetNormal').style.display = 'none';
		document.querySelector('.mainInner2').querySelector('.assetItm1').style.display = 'none';
		document.querySelector('.mainInner2').querySelector('.assetItm2').style.display = 'none';
		document.querySelector('.mainInner2').querySelector('.imgWrap').style.display = '';
	 	   
		if(totCnt === 0){
			//pcts.push(0);
			//pcts.push(0);
			//pcts.push(0);
			//pcts.push(0);
			//pcts.push(1);
			let assetNormal = document.querySelector('.mainInner2').querySelector('.assetNormal');
			assetNormal.style.display = '';
			assetNormal.innerHTML = '';
			assetNormal.append('이상없음');
	    	document.querySelector('.mainInner2').querySelector('.imgWrap').style.display = 'none';
	    	document.querySelector('.mainInner2').querySelector('.assetItm1').style.display = '';
			document.querySelector('.mainInner2').querySelector('.assetItm2').style.display = '';
	    
		}
		else{
			for(let key in chartData){
			   let item = chartData[key];
			   pcts.push(item.cnt/totCnt*100);
			}
			const dountData = {
	 			   labels: labels,
	 			   datasets: [{
	 				   label: 'My First Dataset',
	 			       data: pcts,
	 			       borderColor : '#000',
	 			       borderWidth : 1,
	 			       backgroundColor: [
	 			    	    '#80e080'
	 			           ,'#4fc3f7'
	 			           ,'#9575cd'
	 			      	   ,'#c71585'
	 			           //,'#fff'
	 			       ],
	 			       hoverOffset: 4
	 			   }]
	 	    };
			const config = {
	 	    		type: 'doughnut',
	 			    data: dountData,
	 			    options: {
	 			    	responsive: false,
	 			    	animation: {
		        	         duration: 0
		        	    },
						plugins: {
							legend: {
								position: 'bottom',
			       			    display: true,
			       			    labels: {
			       			    	usePointStyle: true,
	 			                	color: 'black',
	 			                	padding : 10,
	 			                    font: {
	 			                    	size: 16,
	 		                        },
	 			                    fill : false
	 			                }
			       			}
	 	                }
				    }
	 	    };
			config.options.plugins.legend.labels.color = chartColor;
	    	if(donutChart!=null){
	    		donutChart.destroy();
		    }
	    	donutChart = new Chart(document.getElementById('donutChart').getContext("2d"),config);	  
		}
		
		if(totCnt === 0){
			//dountData.datasets[0].backgroundColor.push('#fff');
		}
		
    }
    
    const drawLineChart = (chartData) => {
		let lineLabels = new Array();
    	let dataS = new Array();
    	let dataW = new Array();
    	let dataF = new Array();
    	let dataC = new Array();
    	chartData.forEach((chartItem,index) => {
    		if(chartItem.asset == '1'){
    			lineLabels.push(chartItem.hm);
    			dataS.push(chartItem.cnt);
    	    }
    		else if(chartItem.asset == '2'){
    			dataW.push(chartItem.cnt);
    		}
            else if(chartItem.asset == '3'){
            	dataF.push(chartItem.cnt);
    		}
    		 else if(chartItem.asset == '4'){
            	dataC.push(chartItem.cnt);
    		}
    	});

    	const lineData = {labels: lineLabels,
    			          datasets: [{ label: gfn_getCodeVal('ASLC','1'), //' 서버     ',
    			                        data: dataS,//[65, 59, 80, 81, 56, 55, 40],
    			                        fill: false,
    			                        pointStyle: 'circle',
    			                        pointRadius: 4,
    			                        borderColor: '#80e080',
    			                        backgroundColor: '#80e080',
    			                        tension: 0.1
    			                    },
    			                    { label: gfn_getCodeVal('ASLC','2'), //' 스위치     ',
    			                        data: dataW,//[35, 45, 65, 34, 53, 45, 57],
    			                        fill: false,
    			                        pointStyle: 'circle',
    			                        pointRadius: 4,
    			                        borderColor: '#4fc3f7',
    			                        backgroundColor: '#4fc3f7',
    			                        tension: 0.1
    			                    },
    			                    { label: gfn_getCodeVal('ASLC','3'), //' 네트워크장비     ',
    			                        data: dataF,//[45, 52, 60, 71, 38, 23, 34],
    			                        fill: false,
    			                        pointStyle: 'circle',
    			                        pointRadius: 4,
    			                        borderColor: '#9575cd',
    			                        backgroundColor: '#9575cd',
    			                        //pointBorderColor: 'rgb(75, 89, 192)',
    			                        tension: 0.1
    			                    },
    			                    { label: gfn_getCodeVal('ASLC','4'), //' 보안장비     ',
    			                        data: dataC,//[45, 52, 60, 71, 38, 23, 34],
    			                        fill: false,
    			                        pointStyle: 'circle',
    			                        pointRadius: 4,
    			                        borderColor: '#c71585',
    			                        backgroundColor: '#c71585',
    			                        //pointBorderColor: 'rgb(75, 89, 192)',
    			                        tension: 0.1
    			                    }]
    	                 };
    	
    	const config = { type: 'line',
    			         data: lineData,
    			         options: { responsive: true,
		    			        	animation: {
					        	         duration: 0
					        	    },
    			        	        scales: {
    			        	                 x: {
    			        	                	 ticks: {
    			        	                         color: 'black',
    			        	                	 },
    			        	                	
    			        	                 },
    			        	                 y: {
    			        	                	 ticks: {
    			        	                         color: 'black',
    			        	                     },
    			        	                     grid: {
    			        	                    	 color : 'rgb(90, 90, 90)',
    			        	                         display: true,
    			        	                         //drawOnChartArea: true,
    			        	                         //drawTicks: true,
    			        	                     }
    			        	                 }
    			        	             },
    			        	             
	    			        	    plugins: {legend: {
	    	       			    		      position: 'bottom',
	    	       			                  display: true,
	    	       			                  labels: legendOption
	    	       			                 }
	    	       			      }
    			         },
    			        };
    	if(uiMode != 'white'){
    		config.options.scales.x.ticks.color = 'white';
        	config.options.scales.y.ticks.color = 'white';
        }
    	if(lineChart!=null){
    		lineChart.destroy();
	    }
    	lineChart = new Chart(document.getElementById('lineChart').getContext("2d"),config);	  
    }
    
    const searchAssetAllList = () => {
    	const headColumns = [{data_id:"id",width: "0px"}
					        ,{data_id:"detectionTime",label: "탐지시간" ,data_dateFrmt:"yy-mm-dd hh:mi:ss"}
					        ,{data_id:"largeCategory",label:"대분류" ,data_grpCd:"ASLC"}
					        ,{data_id:"smallCategory",label:"소분류", data_grpCd:"ASSC"}
					        ,{data_id:"assetName",label:"자산명"}
					        ,{data_id:"ipAddress",label:"IP주소"}
					        ,{data_id:"zoneName",label:"구역"}
					        ,{data_id:"manager",label:"관리자", }
					        ,{data_id:"confidentialityLevel",label: "기밀성 중요도", data_grpCd:"COIMS",data_class:"threat" }
					        ,{data_id:"integrityLevel",label: "무결성 중요도", data_grpCd:"COIMS" ,data_class:"threat"}
					        ,{data_id:"availabilityLevel",label: "가용성 중요도", data_grpCd:"COIMS",data_class:"threat"}
					        ,{data_id:"assetStatus",label: "상태" ,data_grpCd:"ASST"}
					        ,{data_id:"statusText",label: "상태 메시지"}
					       ];
     
   		gridInit(document.querySelector('#assetList').querySelector('.tablewrap'),headColumns);
   		//document.querySelector('#assetList').querySelector('.pageNo').setAttribute("value",1);
   		//document.querySelector('#assetList').querySelector('.btnMore').setAttribute("href","javascript:searchAssetMore();");
   		/*
   		let param = { "pageNo" : document.querySelector('#assetList').querySelector('.pageNo').getAttribute("value")
	                , "rowPerPage" : Number(document.querySelector('#assetList').querySelector('.rowPerPage').getAttribute("value"))
    		        };
    	gfn_schParam(param);
    	*/
    	let param = {};
    	gfn_schParam(param);
	 	gfn_asyncJsonCall('/getAssetAllList','POST',param).then((data) => {
	 		let appendData = data['appendData'].listAssetAffair;
	 		//console.log("appendData:",appendData);
	 		let statusData = data['appendData'].listAssetStatus;
	 		let dataNum = document.querySelector('.popInner').querySelector('.dataNum');
    	    dataNum.innerHTML = '';
    	    dataNum.append(statusData.assetCnt+'/'+statusData.totCnt);
	 		drawDonutChartPop(appendData);
	 		let list = data['list'];
	 		gridBind(list,document.querySelector('#assetList').querySelector('.tablewrap'));
	 		return list;
	 	}).then((data) => {
	 		/*
            if(data.length < 15){
            	document.querySelector('#assetList').querySelector('.btnMore').removeAttribute("href");
	 		}
	 		*/
	 		layerPopup('#assetList');
	 	});

    }
    /*  const searchAssetMore = () => {
	
	let pageNo = Number(document.querySelector('#assetList').querySelector('.pageNo').getAttribute("value"));
	pageNo++;
	let param = { pageNo
                , "rowPerPage" : Number(document.querySelector('#assetList').querySelector('.rowPerPage').getAttribute("value"))
		        };
	gfn_schParam(param);
 	gfn_asyncJsonCall('/getAssetAllList','POST',param).then((data) => {
 		let list = data['list'];
 		gridBind(list,document.querySelector('#assetList').querySelector('.tablewrap'),'Y');
 		return list;
 	}).then((data) => {
 		if(data.length < 15){
 			document.querySelector('#assetList').querySelector('.btnMore').removeAttribute("href");
 		}
 		document.querySelector('#assetList').querySelector('.pageNo').setAttribute("value",pageNo);
 	
 	});
} */
    
    const drawDonutChartPop = (chartData) => {
    	console.log("chartData:",chartData);
		const labels = new Array();
		const pcts = new Array();
		let totCnt = 0;
		for(let key in chartData){
		   let item = chartData[key];
		   //console.log("item::::",item);
		   let category = gfn_getCodeVal('ASLC',item.largeCategory);
		   if(category == '서버'){
			   category = category+"             ";
		   }
		   if(category == '단말'){
			   category = category+"      ";
		   }
		   labels.push(category);
		   totCnt += item.cnt;
		}
		
		document.querySelector('.popInner2').querySelector('.assetNormal').style.display = 'none';
		document.querySelector('.popInner2').querySelector('.assetItm1').style.display = 'none';
		document.querySelector('.popInner2').querySelector('.assetItm2').style.display = 'none';
		document.querySelector('.popInner2').querySelector('.imgWrap').style.display = '';
	 	   
		if(totCnt === 0){
			let assetNormal = document.querySelector('.popInner2').querySelector('.assetNormal');
			assetNormal.style.display = '';
			assetNormal.innerHTML = '';
			assetNormal.append('이상없음');
	    	document.querySelector('.popInner2').querySelector('.imgWrap').style.display = 'none';
	    	document.querySelector('.popInner2').querySelector('.assetItm1').style.display = '';
			document.querySelector('.popInner2').querySelector('.assetItm2').style.display = '';
		}
		else{
			for(let key in chartData){
			   let item = chartData[key];
			   pcts.push(item.cnt/totCnt*100);
			}
			const dountData = {
	 			   labels: labels,
	 			   datasets: [{
	 				   label: 'My First Dataset',
	 			       data: pcts,
	 			       borderColor : '#000',
	 			       borderWidth : 1,
	 			       backgroundColor: [
	 			    	    '#80e080'
	 			           ,'#4fc3f7'
	 			           ,'#9575cd'
	 			      	   ,'#c71585'
	 			       ],
	 			       hoverOffset: 4
	 			   }]
	 	    };
			
			const config = {
	 	    		type: 'doughnut',
	 			    data: dountData,
	 			    options: {
	 			    	responsive: false,
	 			    	animation: {
		        	         duration: 0
		        	    },
						plugins: {
							legend: {
								position: 'right',
			       			    display: true,
			       			    labels: {
			       			    	usePointStyle: true,
	 			                	color: 'black',
	 			                	padding : 18,
	 			                    font: {
	 			                    	size: 17,
	 		                        },
	 			                    fill : false
	 			                }
			       			}
	 	                }
				    }
	 	    };
	 	    config.options.plugins.legend.labels.color = chartColor;
	    	if(donutChartPopup!=null){
	    		donutChartPopup.destroy();
		    }
	    	donutChartPopup = new Chart(document.getElementById('donutChartPop').getContext("2d"),config);	  

		}	
 	    
    }

   
   
</script>
</th:block>

</html>
